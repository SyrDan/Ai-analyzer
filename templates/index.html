<!DOCTYPE html>
<html lang="kz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduAnalyzer | Оқу материалдарын талдау</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --warning: #f72585;
            --gray: #6c757d;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
            --radius: 10px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
        }
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
        }
        .subtitle {
            color: var(--gray);
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto;
        }
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .tab-btn {
            background: white;
            border: none;
            padding: 12px 25px;
            margin: 0 5px 10px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--shadow);
            min-width: 180px;
        }
        .tab-btn.active {
            background: var(--primary);
            color: white;
        }
        .tab-btn:hover:not(.active) {
            background: #e9ecef;
        }
        .tab-content {
            display: none;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
            animation: fadeIn 0.4s;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: var(--radius);
            font-family: inherit;
            font-size: 1.05rem;
            margin: 15px 0;
            transition: border-color 0.3s;
        }
        textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 32px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
        }
        .btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.4);
        }
        .btn:active { transform: translateY(0); }
        .btn-block { display: block; width: 100%; margin: 20px 0; }
        .result-container {
            margin-top: 25px;
            display: none;
        }
        .result-container.active { display: block; }
        .card {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 20px;
        }
        .card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary);
            font-size: 1.4rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f4f8;
        }
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        .badge-beginner { background: #e3f2fd; color: #1976d2; }
        .badge-intermediate { background: #e8f5e9; color: #2e7d32; }
        .badge-advanced { background: #fff8e1; color: #5d4037; }
        .keywords { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; }
        .keyword { background: #eef7ff; color: var(--primary); padding: 4px 10px; border-radius: 15px; font-size: 0.95rem; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: var(--radius);
        }
        .stat-value { font-size: 1.8rem; font-weight: 700; color: var(--primary); }
        .stat-label { color: var(--gray); margin-top: 5px; }
        .phase { margin-bottom: 20px; border-left: 3px solid var(--primary); padding-left: 15px; }
        .phase-title { font-weight: 700; font-size: 1.3rem; color: var(--secondary); margin: 10px 0; }
        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .tip-category { background: #f9fbfd; border-radius: var(--radius); padding: 20px; }
        .tip-category h3 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #ddd;
        }
        .tip-list { list-style-type: none; }
        .tip-list li {
            padding: 8px 0 8px 25px;
            position: relative;
            line-height: 1.5;
        }
        .tip-list li:before {
            content: "•";
            position: absolute;
            left: 8px;
            color: var(--success);
            font-weight: bold;
            font-size: 1.4rem;
        }
        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: var(--gray);
            display: none;
        }
        .error {
            background: #fff5f5;
            color: var(--warning);
            border-left: 4px solid var(--warning);
            padding: 15px;
            border-radius: 0 var(--radius) var(--radius) 0;
            margin: 15px 0;
            display: none;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            color: var(--gray);
            border-top: 1px solid #eee;
            font-size: 0.95rem;
        }
        @media (max-width: 768px) {
            .tabs { flex-direction: column; align-items: center; }
            .tab-btn { width: 90%; margin: 5px 0; }
            .stats-grid, .tips-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>EduAnalyzer</h1>
            <p class="subtitle">Оқу мәтіндерін интеллектуалды талдау, оқу жоспарларын құру және кез-келген тақырыпты тиімді зерттеуге арналған жеке кеңестер</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="analyzer">Мәтінді талдау</button>
            <button class="tab-btn" data-tab="plan">Оқу жопсар</button>
            <button class="tab-btn" data-tab="tips">Кеңестер</button>
        </div>

        <!-- Text Analyzer Tab -->
        <div id="analyzer" class="tab-content active">
            <h2>Оқу материалын талдаңыз</h2>
            <p>Күрделілікті, негізгі ұғымдар мен ұсыныстарды талдау үшін мәтінді (кем дегенде 50 таңба) салыңыз</p>
            <textarea id="text-input" placeholder="Вставьте сюда ваш учебный текст...">Жасанды интеллект (AI) - интеллектуалды машиналар жасауға арналған информатика саласы. Машиналық оқыту негіздеріне деректерден Үйренетін Алгоритмдер кіреді. Нейрондық желілермен жұмыс істеу тәжірибесі математикалық негіздерді түсінуді қажет етеді. Жетілдірілген аспектілерге архитектураны оңтайландыру және табиғи тілді өңдеу кіреді.</textarea>
            <button id="analyze-btn" class="btn">
                <span>Мәтінді талдау</span>
            </button>
            <div class="loading" id="analyze-loading">Анализируем текст...</div>
            <div class="error" id="analyze-error"></div>
            <div class="result-container" id="analyze-result"></div>
        </div>

        <!-- Study Plan Tab -->
        <div id="plan" class="tab-content">
            <h2>Тақырып бойынша оқу жоспарын жасаңыз</h2>
            <p>Ресурстар мен ұсыныстармен қадамдық оқу жоспарын құру үшін тақырыпты енгізіңіз</p>
            <input type="text" id="topic-input" class="topic-input" placeholder="Например: Машинное обучение, Веб-разработка, Финансовый анализ" value="Программирование на Python">
            <button id="plan-btn" class="btn btn-block">Оқу жоспарын жасаңыз</button>
            <div class="loading" id="plan-loading">Жоспар құру... </div>
            <div class="error" id="plan-error"></div>
            <div class="result-container" id="plan-result"></div>
        </div>

        <!-- Quick Tips Tab -->
        <div id="tips" class="tab-content">
            <h2>Тиімді оқытуға арналған жылдам кеңестер</h2>
            <p>Өнімділікті арттыру үшін дәлелденген әдістер мен лайфхактарды алыңыз</p>
            <button id="tips-btn" class="btn btn-block">Кеңестерді көрсету</button>
            <div class="loading" id="tips-loading">Кеңестер дайындау... </div>
            <div class="result-container" id="tips-result">
                <!-- Preload with static tips for instant visibility -->
                <div class="tips-grid">
                    <div class="tip-category">
                        <h3> Жалпы принциптер</h3>
                        <ul class="tip-list">
                            <li>Негіздерден бастаңыз-тақырыптардан секірмеңіз</li>
                            <li>Күнделікті жаттығу (кем дегенде 30 минут)</li>
                            <li>Негізгі ойлардың қысқаша мазмұнын сақтаңыз</li>
                        </ul>
                    </div>
                    <div class="tip-category">
                        <h3>Есте сақтау әдістері</h3>
                        <ul class="tip-list">
                            <li>Фейнман әдісі: тақырыпты қарапайым сөздермен түсіндіріңіз</li>
                            <li>Белсенді қайталау: өзіңізді сынап көріңіз</li>
                            <li>Аралық қайталау: 1/3/7/14 күн</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>EduAnalyzer © 2026 | Саналы оқыту құралы</p>
            <p>Талдау эвристикалық алгоритмдерге негізделген.</p>
        </footer>
    </div>

    <script>
        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Deactivate all
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Activate selected
                btn.classList.add('active');
                document.getElementById(btn.dataset.tab).classList.add('active');
            });
        });

        // Text Analyzer
        document.getElementById('analyze-btn').addEventListener('click', async () => {
            const text = document.getElementById('text-input').value.trim();
            const loading = document.getElementById('analyze-loading');
            const errorEl = document.getElementById('analyze-error');
            const resultEl = document.getElementById('analyze-result');
            
            if (text.length < 50) {
                showError(errorEl, 'Текст должен содержать минимум 50 символов');
                return;
            }
            
            loading.style.display = 'block';
            errorEl.style.display = 'none';
            resultEl.classList.remove('active');
            
            try {
                const res = await fetch('/analyze', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({text})
                });
                
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'Ошибка анализа');
                
                // Render result
                resultEl.innerHTML = `
                    <div class="card">
                        <div class="card-title">Қысқаша мазмұны</div>
                        <p>${escapeHtml(data.analysis.summary)}</p>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">Негізгі ұғымдар</div>
                        <div class="keywords">
                            ${data.analysis.key_concepts.map(k => `<span class="keyword">${escapeHtml(k)}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">Материалдың күрделілігі</div>
                        <div>
                            <span class="badge badge-${getDifficultyClass(data.analysis.difficulty_level)}">
                                ${getDifficultyLabel(data.analysis.difficulty_level)}
                            </span>
                            <p style="margin-top:10px"><strong>Ұсынылатын оқу уақыты:</strong> ${escapeHtml(data.analysis.estimated_time)}</p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title"> Зерттеу бойынша ұсыныстар</div>
                        <p><strong>Тәсіл:</strong> ${escapeHtml(data.analysis.learning_recommendations.approach)}</p>
                        <p><strong>Алдын ала талаптар:</strong> ${data.analysis.learning_recommendations.prerequisites.join(', ')}</p>
                        <p><strong>Жаттығу:</strong></p>
                        <ul style="padding-left:20px;margin-top:8px">
                            ${data.analysis.learning_recommendations.exercises.map(e => `<li>${escapeHtml(e)}</li>`).join('')}
                        </ul>
                        <p><strong>Ресурстар:</strong> ${data.analysis.learning_recommendations.resources.join(', ')}</p>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">Мәтін статистикасы</div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value">${data.statistics.word_count}</div>
                                <div class="stat-label">Сөздер</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${data.statistics.sentence_count}</div>
                                <div class="stat-label">Ұсыныстар</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${data.statistics.text_length}</div>
                                <div class="stat-label">Рәміздер</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">Қатысты тақырыптар</div>
                        <ul style="padding-left:20px">
                            ${data.analysis.related_topics.map(t => `<li>${escapeHtml(t)}</li>`).join('')}
                        </ul>
                    </div>
                `;
                resultEl.classList.add('active');
            } catch (e) {
                showError(errorEl, e.message);
            } finally {
                loading.style.display = 'none';
            }
        });

        // Study Plan Generator
        document.getElementById('plan-btn').addEventListener('click', async () => {
            const topic = document.getElementById('topic-input').value.trim();
            const loading = document.getElementById('plan-loading');
            const errorEl = document.getElementById('plan-error');
            const resultEl = document.getElementById('plan-result');
            
            if (!topic) {
                showError(errorEl, 'Жоспар құру үшін тақырыпты енгізіңіз');
                return;
            }
            
            loading.style.display = 'block';
            errorEl.style.display = 'none';
            resultEl.classList.remove('active');
            
            try {
                const res = await fetch('/suggest-plan', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({topic})
                });
                
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'Жоспар құру қатесі');
                
                // Render plan
                let phasesHTML = '';
                data.phases.forEach(phase => {
                    phasesHTML += `
                        <div class="phase">
                            <div class="phase-title">Этап ${phase.phase}: ${escapeHtml(phase.title)} (${phase.duration})</div>
                            <p><strong>Мақсатр:</strong> ${phase.goals.join(', ')}</p>
                            <p><strong>Белсенділік:</strong></p>
                            <ul style="padding-left:20px;margin-top:5px">
                                ${phase.activities.map(a => `<li>${escapeHtml(a)}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                });
                
                resultEl.innerHTML = `
                    <div class="card">
                        <div class="card-title">Оқу жоспар: "${escapeHtml(data.topic)}"</div>
                        <p><strong>Жалпы ұзақтығы:</strong> ${escapeHtml(data.total_duration)}</p>
                        <p><strong>Күнделікті тәртіп:</strong></p>
                        <ul style="padding-left:20px;margin-top:8px">
                            <li>Теория: ${escapeHtml(data.daily_routine.theory)}</li>
                            <li>Практика: ${escapeHtml(data.daily_routine.practice)}</li>
                            <li>Повторение: ${escapeHtml(data.daily_routine.review)}</li>
                        </ul>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">Оқыту кезеңдері</div>
                        ${phasesHTML}
                    </div>
                    
                    <div class="card">
                        <div class="card-title">Ұсынылатын ресурстар</div>
                        <ul style="padding-left:20px">
                            ${data.resources.map(r => `<li>${escapeHtml(r)}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">Табысқа жету үшін кеңестер</div>
                        <ul style="padding-left:20px">
                            ${data.tips.map(t => `<li>${escapeHtml(t)}</li>`).join('')}
                        </ul>
                    </div>
                `;
                resultEl.classList.add('active');
            } catch (e) {
                showError(errorEl, e.message);
            } finally {
                loading.style.display = 'none';
            }
        });

        // Quick Tips (enhanced with live fetch)
        document.getElementById('tips-btn').addEventListener('click', async () => {
            const loading = document.getElementById('tips-loading');
            const resultEl = document.getElementById('tips-result');
            
            loading.style.display = 'block';
            resultEl.classList.remove('active');
            
            try {
                const res = await fetch('/quick-tips', {method: 'POST'});
                const data = await res.json();
                
                resultEl.innerHTML = `
                    <div class="tips-grid">
                        <div class="tip-category">
                            <h3>Жалпы принциптер</h3>
                            <ul class="tip-list">
                                ${data.general.map(t => `<li>${escapeHtml(t)}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="tip-category">
                            <h3>Оқыту әдістері</h3>
                            <ul class="tip-list">
                                ${data.learning_methods.map(t => `<li>${escapeHtml(t)}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="tip-category">
                            <h3>Өнімділік</h3>
                            <ul class="tip-list">
                                ${data.productivity.map(t => `<li>${escapeHtml(t)}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
                resultEl.classList.add('active');
            } catch (e) {
                console.error('Кеңестерді жүктеу қатесі:', e);
                // Keep preloaded tips visible on error
            } finally {
                loading.style.display = 'none';
            }
        });

        // Helper functions
        function showError(el, message) {
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => { el.style.display = 'none'; }, 5000);
        }
        
        function getDifficultyClass(level) {
            return level === 'бастапқы' ? 'beginner' : 
                   level === 'орташа' ? 'intermediate' : 'advanced';
        }
        
        function getDifficultyLabel(level) {
            return level === 'бастапқы' ? 'Бастапқы деңгейі' : 
                   level === 'орташа' ? 'Орташа деңгейі' : 'Жетілдірілген деңгей';
        }
        
        function escapeHtml(unsafe) {
            if (typeof unsafe !== 'string') return unsafe;
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        // Pre-trigger tips load on page load for better UX
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('tips-btn').click();
        });
    </script>
</body>

</html>
